

# Diff 实现思路

### Myers算法

Myers算法是基于查找最短编辑脚本（*shortest edit script*, SES）的思想提出的。将最短路径问题转换为图搜索，通过贪心策略，将问题分解为子问题。

根据给定的两个字符串我们可以构造一张图，横轴是 strBefore 内容，纵轴是 strAfter 内容。

那么，图中每一条从左上角到右下角的路径，都表示一个 diff。向右表示“删除”，向下表示”新增“，对角线则表示“原内容保持不动“。

Myers算法就是要找出一条从左上角到右下角的路径，让这条路径中的删除和新增操作尽量的少，这就要求要尽量执行“保持不动”操作，并且当出现分支选择的时候，删除操作能够优先于新增操作。

---

**寻找最少操作数算法：**

定义最少操作数 
```tex
dp[len(strBefore)][len(strAfter)]
```

计算初始值
```tex
dp(i,0)=dp(i-1,0)+1\\
dp(0,j)=dp(0,j-1)+1
```

状态转移方程：
```tex
dp(i,j) = min\{dp(i-1,j),dp(i-1,j-1),dp(i,j-1)\}+1
```
---

定义d表示图的搜索深度，也就是目前为止已经执行了多少次删除或者新增操作；k = x - y，当我们向右移动时，k值会加1，当向下移动时，k值会减1，而当沿着虚线移动时，k值并不会变化。最优坐标表示 d 和 k 值固定的情况下，x 值最大的坐标。x 大，表示向右走的多，表示优先删除。

**diff算法过程：**

1. 我们首先从0到len(strBefore)+len(strAfter)遍历d
2. 每次迭代d时，我们以步长为2从-d到d遍历k；
3. 使用一个字典 v，以 k 值为索引，存储最优坐标的 x 值
4. 将每个 d 对应的 v 字典存储起来
5. 当我们找到一个 d 和 k，到达目标坐标 (len(strBefore), len(strAfter)) 时就跳出循环
6. 使用上面存储的 v 字典（每个 d 对应一个这样的字典），从终点反向得出路径